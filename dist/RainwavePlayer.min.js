var RainwavePlayer=function(){"use strict";var e={playing:[],stop:[],change:[],volumeChange:[],loading:[],stall:[],error:[],longLoadWarning:[]},t={1:["http://gamestream.rainwave.cc:8000/game"],2:["http://ocrstream.rainwave.cc:8000/ocremix"],3:["http://overstream.rainwave.cc:8000/covers"],4:["http://chipstream.rainwave.cc:8000/chiptune"],5:["http://allstream.rainwave.cc:8000/all"]},n={game:1,ocr:2,ocremix:2,"oc remix":2,cover:3,covers:3,chip:4,chiptune:4,chiptunes:4,all:5},i={};i.isSupported=!1,i.type=null,i.audioElDest=!1,i.isPlaying=!1,i.volume=1,i.isMuted=!1,i.mimetype="";var a=[],o=-1!==navigator.userAgent.toLowerCase().indexOf("mobile")||-1!==navigator.userAgent.toLowerCase().indexOf("android"),r=!1,s=function(e){try{return new Event(e)}catch(t){return{type:e}}},c=document.createElement("audio");if("canPlayType"in c){var l=c.canPlayType('audio/mpeg; codecs="mp3"');("maybe"==l||"probably"==l)&&(i.mimetype="audio/mpeg",i.type="mp3",i.isSupported=!0);var d=!1;o||(d=c.canPlayType('audio/ogg; codecs="vorbis"')),!(navigator.mozIsLocallyAvailable||navigator.mozApps||navigator.mozContacts)||"maybe"!=d&&"probably"!=d||(i.mimetype="audio/ogg",i.type="ogg",i.isSupported=!0),navigator.userAgent.indexOf("Chrome")>-1&&navigator.userAgent.indexOf("Android")>-1&&(r=!0)}c=null;var u=function(){return c?i.stop():(i.isPlaying=!1,c=document.createElement("audio"),c.addEventListener("stop",w),c.addEventListener("playing",y),c.addEventListener("stalled",L),c.addEventListener("waiting",E),c.volume=i.volume,i.audioElDest||(i.audioElDest=document.createElement("div")),void i.audioElDest.appendChild(c))},p=function(e,t){var n=document.createElement("source");return n.setAttribute("src",t),n.setAttribute("type",i.mimetype),e===a.length-1?n.addEventListener("error",C):n.addEventListener("error",function(t){L(t,e)}),n};i.useStation=function(e){(isNaN(parseInt(e))||!t[parseInt(e)])&&(e.toLowerCase&&n[e.toLowerCase()]?e=n[e.toLowerCase()]:(console.warn("Unknown Rainwave Station "+e+", defaulting to All."),e=5)),a=[t[e]+"."+i.type]},i.useStreamURLs=function(e){a=e},i.playToggle=function(){i.isPlaying?i.stop():i.play()},i.play=function(){if(!i.isSupported)return void console.error("Rainwave HTML5 Audio Playback is not supported on this browser.");if(!i.isPlaying){c||u(),r&&i.dispatchEvent(s("longLoadWarning"));for(var e=0;e<a.length;e++)c.appendChild(p(e,a[e]));c.play(),i.isPlaying=!0,i.dispatchEvent(s("loading")),i.dispatchEvent(s("change"))}},i.stop=function(){if(i.isSupported&&c){for(;c.firstChild;)c.removeChild(c.firstChild);c.parentNode&&c.parentNode.removeChild(c),c.pause(0),c.removeAttribute("src");try{c.load()}catch(e){}c=null,u(),i.dispatchEvent(s("stop")),i.dispatchEvent(s("change"))}},i.toggleMute=function(){i.isMuted?(i.isMuted=!1,c&&(c.volume=i.volume),i.dispatchEvent(s("volumeChange"))):(i.isMuted=!0,c&&(c.volume=0),i.dispatchEvent(s("volumeChange")))},i.setVolume=function(e){i.volume=e,c&&!i.isMuted&&(c.volume=e),i.dispatchEvent(s("volumeChange"))};var v,m,g=function(){v&&(clearTimeout(v),v=null),m=!1},h=function(e){if(m)f(e);else{if(v)return;v=setTimeout(function(){f(e)},1e3)}},f=function(e){var t=s("stall");t.detail=e,i.dispatchEvent(t),v=null,m=!0},y=function(){g(),i.dispatchEvent(s("playing")),i.dispatchEvent(s("change"))},E=function(){g(),i.dispatchEvent(s("loading"))},w=function(){g(),i.dispatchEvent(s("stop")),i.dispatchEvent(s("change"))},L=function(e,t){if(void 0!==t||!r){var n;void 0!==t&&(n=" ("+(t+1)+"/"+a.length+")"),h(n)}},C=function(e){g(),i.stop(),i.dispatchEvent(s("error"))};return i.dispatchEvent=function(t){if(!t)return void console.error("RainwavePlayer: No event specified to dispatch.");if(!e[t.type])return void console.error("RainwavePlayer: Invalid event type.");for(var n=0;n<e[t.type].length;n++)e[t.type][n](t)},i.addEventListener=function(t,n){return e[t]?void e[t].push(n):void console.error(t+" is not a supported event for the Rainwave Player.")},i.removeEventListener=function(t,n){if(e[t])for(;-1!==e[t].indexOf(n);)e[t].splice(e[t].indexOf(n),1)},i}();