var RainwavePlayer=function(){"use strict";var e={playing:[],stop:[],change:[],volumeChange:[],loading:[],stall:[],error:[],longLoadWarning:[]},t={1:["http://gamestream.rainwave.cc:8000/game"],2:["http://ocrstream.rainwave.cc:8000/ocremix"],3:["http://overstream.rainwave.cc:8000/covers"],4:["http://chipstream.rainwave.cc:8000/chiptune"],5:["http://allstream.rainwave.cc:8000/all"]},n={game:1,ocr:2,ocremix:2,"oc remix":2,cover:3,covers:3,chip:4,chiptune:4,chiptunes:4,all:5},i={};i.isSupported=!1,i.type=null,i.audioElDest=!1,i.isPlaying=!1,i.volume=1,i.isMuted=!1,i.mimetype="";var a=[],o=1,r=-1!==navigator.userAgent.toLowerCase().indexOf("mobile")||-1!==navigator.userAgent.toLowerCase().indexOf("android"),s=!1,l=function(e){try{return new Event(e)}catch(t){return{type:e}}},u=document.createElement("audio");if("canPlayType"in u){var c=!1;r||(c=u.canPlayType('audio/ogg; codecs="vorbis"')),!(navigator.mozIsLocallyAvailable||navigator.mozApps||navigator.mozContacts)||"maybe"!=c&&"probably"!=c||(i.mimetype="audio/ogg",i.type="ogg",i.isSupported=!0);var d=u.canPlayType('audio/mpeg; codecs="mp3"');(!i.isSupported&&"maybe"==d||"probably"==d)&&(i.mimetype="audio/mpeg",i.type="mp3",i.isSupported=!0),navigator.userAgent.indexOf("Chrome")>-1&&navigator.userAgent.indexOf("Android")>-1&&(s=!0)}u=null;var p=function(){return u?i.stop():(i.isPlaying=!1,u=document.createElement("audio"),u.addEventListener("stop",L),u.addEventListener("playing",E),u.addEventListener("stalled",C),u.addEventListener("waiting",w),u.volume=i.volume,i.audioElDest||(i.audioElDest=document.createElement("div")),void i.audioElDest.appendChild(u))},v=function(e,t){var n=document.createElement("source");return n.setAttribute("src",t),n.setAttribute("type",i.mimetype),e==a.length-1?n.addEventListener("error",b):n.addEventListener("error",function(t){C(t,e)}),n};i.useStation=function(e){(isNaN(parseInt(e))||!t[parseInt(e)])&&(e.toLowerCase&&n[e.toLowerCase()]?e=n[e.toLowerCase()]:(console.warn("Unknown Rainwave Station "+e+", defaulting to All."),e=5)),a=[t[e]+"."+i.type]},i.useStreamURLs=function(e){a=e},i.playToggle=function(){i.isPlaying?i.stop():i.play()},i.play=function(){if(!i.isSupported)return void console.error("Rainwave HTML5 Audio Playback is not supported on this browser.");if(!i.isPlaying){u||p(),s&&i.dispatchEvent(l("longLoadWarning"));for(var e=0;e<a.length;e++)u.appendChild(v(e,a[e]));u.play(),i.isPlaying=!0,i.dispatchEvent(l("playing")),i.dispatchEvent(l("change"))}},i.stop=function(){if(i.isSupported&&u){for(;u.firstChild;)u.removeChild(u.firstChild);u.parentNode&&u.parentNode.removeChild(u),u.pause(0),u.removeAttribute("src");try{u.load()}catch(e){}u=null,p(),i.dispatchEvent(l("stop")),i.dispatchEvent(l("change"))}},i.toggleMute=function(){i.isMuted?(i.isMuted=!1,u&&(u.volume=o||i.volume),i.volume=o,i.dispatchEvent(l("volumeChange"))):(i.isMuted=!0,o=i.volume,i.volume=0,u&&(u.volume=0),i.dispatchEvent(l("volumeChange")))},i.setVolume=function(e){return i.isMuted?void(o=e):(i.volume=e,u&&(u.volume=e),void i.dispatchEvent(l("volumeChange")))};var m,g,h=function(){m&&(clearTimeout(m),m=null),g=!1},f=function(e){if(g)y(e);else{if(m)return;m=setTimeout(function(){y(e)},1e3)}},y=function(e){var t=l("stall");t.detail=e,i.dispatchEvent(t),m=null,g=!0},E=function(){h(),i.dispatchEvent(l("playing")),i.dispatchEvent(l("change"))},w=function(){h(),i.dispatchEvent(l("loading"))},L=function(){h(),i.dispatchEvent(l("stop")),i.dispatchEvent(l("change"))},C=function(e,t){if(void 0!==t||!s){var n;void 0!==t&&(n=" ("+(t+1)+"/"+a.length+")"),f(n)}},b=function(e){h(),i.stop(),i.dispatchEvent(l("error"))};return i.dispatchEvent=function(t){if(!t)return void console.error("RainwavePlayer: No event specified to dispatch.");if(!e[t.type])return void console.error("RainwavePlayer: Invalid event type.");for(var n=0;n<e[t.type].length;n++)e[t.type][n](t)},i.addEventListener=function(t,n){return e[t]?void e[t].push(n):void console.error(t+" is not a supported event for the Rainwave Player.")},i.removeEventListener=function(t,n){if(e[t])for(;-1!==e[t].indexOf(n);)e[t].splice(e[t].indexOf(n),1)},i}();