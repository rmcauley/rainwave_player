var RainwavePlayer=function(){"use strict";var e={playing:[],stop:[],change:[],volumeChange:[],loading:[],stall:[],error:[],longLoadWarning:[]},t={1:["http://gamestream.rainwave.cc:8000/game"],2:["http://ocrstream.rainwave.cc:8000/ocremix"],3:["http://overstream.rainwave.cc:8000/covers"],4:["http://chipstream.rainwave.cc:8000/chiptune"],5:["http://allstream.rainwave.cc:8000/all"]},n={game:1,ocr:2,ocremix:2,"oc remix":2,cover:3,covers:3,chip:4,chiptune:4,chiptunes:4,all:5},i={};i.isSupported=!1,i.type=null,i.audioElDest=!1,i.isPlaying=!1,i.volume=1,i.isMuted=!1,i.mimetype="";var a=[],o=1,r=-1!==navigator.userAgent.toLowerCase().indexOf("mobile")||-1!==navigator.userAgent.toLowerCase().indexOf("android"),s=!1,u=function(e){try{return new Event(e)}catch(t){return{type:e}}},c=document.createElement("audio");if("canPlayType"in c){var l=!1;r||(l=c.canPlayType('audio/ogg; codecs="vorbis"')),!(navigator.mozIsLocallyAvailable||navigator.mozApps||navigator.mozContacts)||"maybe"!=l&&"probably"!=l||(i.mimetype="audio/ogg",i.type="ogg",i.isSupported=!0);var d=c.canPlayType('audio/mpeg; codecs="mp3"');(!i.isSupported&&"maybe"==d||"probably"==d)&&(i.mimetype="audio/mpeg",i.type="mp3",i.isSupported=!0),navigator.userAgent.indexOf("Chrome")>-1&&navigator.userAgent.indexOf("Android")>-1&&(s=!0)}c=null;var p=function(){return c?i.stop():(i.isPlaying=!1,c=document.createElement("audio"),c.addEventListener("stop",C),c.addEventListener("playing",E),c.addEventListener("stalled",L),c.addEventListener("waiting",w),c.volume=i.volume,i.audioElDest||(i.audioElDest=document.createElement("div")),void i.audioElDest.appendChild(c))},v=function(e,t){var n=document.createElement("source");return n.setAttribute("src",t),n.setAttribute("type",i.mimetype),e==a.length-1?n.addEventListener("error",b):n.addEventListener("error",function(t){L(t,e)}),n};i.useStation=function(e){(isNaN(parseInt(e))||!t[parseInt(e)])&&(e.toLowerCase&&n[e.toLowerCase()]?e=n[e.toLowerCase()]:(console.warn("Unknown Rainwave Station "+e+", defaulting to All."),e=5)),a=[t[e]+"."+i.type]},i.useStreamURLs=function(e){a=e},i.playToggle=function(){i.isPlaying?i.stop():i.play()},i.play=function(){if(!i.isSupported)return void console.error("Rainwave HTML5 Audio Playback is not supported on this browser.");if(!i.isPlaying){c||p(),s&&i.dispatchEvent();for(var e=0;e<a.length;e++)c.appendChild(v(e,a[e]));c.play(),i.isPlaying=!0,i.dispatchEvent(u("playing")),i.dispatchEvent(u("change"))}},i.stop=function(){if(i.isSupported&&c){for(;c.firstChild;)c.removeChild(c.firstChild);c.parentNode&&c.parentNode.removeChild(c),c.pause(0),c.removeAttribute("src");try{c.load()}catch(e){}c=null,p(),i.dispatchEvent(u("stop")),i.dispatchEvent(u("change"))}},i.toggleMute=function(){i.isMuted?(i.isMuted=!1,c&&(c.volume=o||i.volume),i.volume=o,i.dispatchEvent(u("volumeChange"))):(i.isMuted=!0,o=i.volume,i.volume=0,c&&(c.volume=0),i.dispatchEvent(u("volumeChange")))},i.setVolume=function(e){return i.isMuted?void(o=e):(i.volume=e,c&&(c.volume=e),void i.dispatchEvent(u("volumeChange")))};var m,g,h=function(){m&&(clearTimeout(m),m=null),g=!1},f=function(e){if(g)y(e);else{if(m)return;m=setTimeout(function(){y(e)},1e3)}},y=function(e){var t=u("stall");t.detail=e,i.dispatchEvent(t),m=null,g=!0},E=function(){h(),i.dispatchEvent(u("playing")),i.dispatchEvent(u("change"))},w=function(){h(),i.dispatchEvent(u("loading"))},C=function(){h(),i.dispatchEvent(u("stop")),i.dispatchEvent(u("change"))},L=function(e,t){if(void 0!==t||!s){var n;void 0!==t&&(n=" ("+(t+1)+"/"+a.length+")"),f(n)}},b=function(e){h(),i.stop(),i.dispatchEvent(u("error"))};return i.dispatchEvent=function(t){if(e[t.type])for(var n=0;n<e[t.type].length;n++)e[t.type][n](t)},i.addEventListener=function(t,n){return e[t]?void e[t].push(n):void console.error(t+" is not a supported event for the Rainwave Player.")},i.removeEventListener=function(t,n){if(e[t])for(;-1!==e[t].indexOf(n);)e[t].splice(e[t].indexOf(n),1)},i}();